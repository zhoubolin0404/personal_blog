---
title: "时间序列分析：第一章_1"
author: "周博霖"
date: "2024/8/12"
categories: [学习笔记,统计方法,时间序列分析]
image: "cover.png"
bibliography: references.bib
csl: apa.csl
number-sections: true
---

```{r chapter-status, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
library(tidyverse)
library(webexercises)
library(astsa)
library(xts)
```

主要参考书籍为Shumway和Stoffer[-@Shumway_2017]的Time Series Analysis and Its Applications: With R Examples。

该书第五版正在制作，配套`astsa`包中的部分数据集会逐渐更新，所以后期也许会换成第五版内容。

该内容为学习笔记，会很碎片化，同时参考了作者在[github](https://github.com/nickpoison/tsa4/blob/master/textRcode.md)上给出的代码。

时间序列分析适用情境：

* **金融**：每日股市配额、每月失业人口
* **社会科学**：人口序列
* **流行病学**：一段时间内流感人数
* **药学**：一段时间内血压测量
* **fMRI**：脑成像的时间序列
等

两种不同但不一定互斥的时间序列分析方法：

* **时域方法**(*time domain approach*)：对滞后关系的研究最重要(例如：今天发生的事如何影响明天将要发生的事)
* **频域方法**(*frequency domain approach*)：对周期的研究最重要(例如：繁荣和萧条时期是什么样的经济周期)

# 时间序列数据

## 强生公司季度每股收益

`jj`：强生公司的季度每股收益，从1960年第一季度到1980年最后一季度的84个季度(共21年)。

```{r}
library(astsa)
jj
```

```{r Johnson}
#| label: fig-强生公司季度每股收益
#| fig-cap: 强生公司季度每股收益
tsplot(jj, col = 4, type = "o", xlab = "时间", ylab = "季度每股收益")
```

## 全球变暖

这里我使用了最新数据，老数据`globtemp`计划被删除。

`gtemp_land`：1850年到2023年，每年地球陆地年平均温度偏差(以摄氏度为单位，相对于1991-2020年的平均值)。

```{r}
gtemp_land
```

```{r Global_Warming}
#| label: fig-全球变暖
#| fig-cap: 全球陆地年平均温度偏差(1850-2023)
tsplot(gtemp_land, col = 4, type = "o", xlab = "时间", ylab = "全球温度偏差/℃")
```

## 语音数据

`speech`：为“aaa…hhh”这一短语录制的0.1秒(1000采样点)语音样本。

```{r}
attributes(speech)
```

```{r speech}
#| label: fig-语音数据
#| fig-cap: 10000点每秒速度采样的音节aaa···hhh的语音记录，n = 1020
tsplot(speech)
```

## 道琼斯工业平均指数

`djia`：从2006年4月20日到2016年4月20日，道琼斯工业平均指数的每日数值

`djia`数据目前只使用其中的收盘价(`Close`，不确定是昨收还是今收，不过这也不重要)。

假设$x_t$是实际值，则$r_t=\frac{x_t-x_{t-1}}{x_{t-1}}$是收益率，那么$1+r_t=\frac{x_t}{x_{t-1}}$，则有$log(1+r_t)=log(\frac{x_t}{x_{t-1}})=log(x_t)-log(x_{t-1})\approx r_t$($r_t$很小，泰勒级数展开后成立)。

`djiar`为2006年4月21日到2016年4月20日的日收益率。

```{r}
library(xts)
djiar = diff(log(djia$Close))[-1]
```

```{r djiar}
#| label: fig-djiar
#| fig-cap: DJIA日收益率
plot(djiar, col = 4, main = "DJIA Returns") 
```

## 厄尔尼诺和鱼群

`soi`：1950-1987年间453个月的南方涛动指数(SOI)

`rec`：1950-1987年间453个月的新鱼数量指数(Recruitment)

```{r SOI}
#| label: fig-SOI
#| fig-cap: 每月SOI和新鱼数量指数
par(mfrow = c(2, 1)) 
tsplot(soi, col = 4, xlab = "", ylab = "", main = "Southern Oscillation Index")
tsplot(rec, col = 4, xlab = "", ylab = "", main = "Recruitment") 
```

## fMRi成像

`fmri1`：由8个位置的平均fMRI 血氧水平依赖(BOLD)信号组成的数据集。刺激持续32秒，然后停止32秒。信号周期为64秒，采样率为每2秒1次，采样时间为256秒($n=128$)。

```{r fMRI}
#| label: fig-fMRI
#| fig-cap: 大脑皮层、丘脑、小脑各部位的fMRI数据
par(mfrow = c(2, 1))  
tsplot(fmri1[, 2:5], col = 1:4, ylab = "BOLD", main = "大脑皮层", spaghetti = TRUE)
tsplot(fmri1[, 6:9], col = 1:4, ylab = "BOLD", main = "丘脑和小脑", spaghetti = TRUE)
```

```{r}
#| label: fig-fMRI_each
#| fig-cap: 分别展示
tsplot(fmri1[, 2:9], col = 1:8, lwd = 2, ncol = 2, ylim = c(-.6,.6))
```

```{r}
#| label: fig-fMRI_each_2
#| fig-cap: 包含刺激信息
x = ts(fmri1[, 4:9], start = 0, freq = 32)         
names = c("大脑皮层", "丘脑", "小脑")
u = ts(rep(c(rep(.6, 16), rep(-.6, 16)), 4), start = 0, freq = 32)
par(mfrow = c(3, 1))
for (i in 1:3){ 
  j = 2*i - 1
  tsplot(x[, j:(j+1)], ylab = "BOLD", xlab = "", main = names[i], col = 5:6, ylim = c(-.6, .6), 
         lwd = 2, xaxt = "n", spaghetti = TRUE)
  axis(seq(0, 256, 64), side = 1, at = 0:4)
  lines(u, type = "s", col = gray(.3)) 
}
mtext("seconds", side = 1, line = 1.75, cex = .9)
```

## 地震和爆炸

`EQ5`：某地区地震的纵波和横波(两阶段)
`EXP6`：某地区爆炸的纵波和横波(两阶段)

```{r}
#| label: fig-earthquakes
#| fig-cap: 地震和爆炸两阶段，1秒40个采样点
par(mfrow = 2:1)
tsplot(EQ5,  col = 4, main = "地震")
tsplot(EXP6, col = 4, main = "爆炸")
```

