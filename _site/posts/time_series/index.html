<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="周博霖">
<meta name="dcterms.date" content="2024-08-10">

<title>Zhou Bolin’s blog - 时间序列分析：第一章</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Zhou Bolin’s blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">个人简介</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zhoubolin0404"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">时间序列分析：第一章</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">学习笔记</div>
                <div class="quarto-category">统计方法</div>
                <div class="quarto-category">时间序列分析</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">作者</div>
      <div class="quarto-title-meta-contents">
               <p>周博霖 </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">发布于</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 10, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">修改于</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">August 13, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">该页面内容</h2>
   
  <ul class="collapse">
  <li><a href="#时间序列数据" id="toc-时间序列数据" class="nav-link active" data-scroll-target="#时间序列数据"><span class="header-section-number">1</span> 时间序列数据</a>
  <ul class="collapse">
  <li><a href="#强生公司季度每股收益" id="toc-强生公司季度每股收益" class="nav-link" data-scroll-target="#强生公司季度每股收益"><span class="header-section-number">1.1</span> 强生公司季度每股收益</a></li>
  <li><a href="#全球变暖" id="toc-全球变暖" class="nav-link" data-scroll-target="#全球变暖"><span class="header-section-number">1.2</span> 全球变暖</a></li>
  <li><a href="#语音数据" id="toc-语音数据" class="nav-link" data-scroll-target="#语音数据"><span class="header-section-number">1.3</span> 语音数据</a></li>
  <li><a href="#道琼斯工业平均指数" id="toc-道琼斯工业平均指数" class="nav-link" data-scroll-target="#道琼斯工业平均指数"><span class="header-section-number">1.4</span> 道琼斯工业平均指数</a></li>
  <li><a href="#厄尔尼诺和鱼群" id="toc-厄尔尼诺和鱼群" class="nav-link" data-scroll-target="#厄尔尼诺和鱼群"><span class="header-section-number">1.5</span> 厄尔尼诺和鱼群</a></li>
  <li><a href="#fmri成像" id="toc-fmri成像" class="nav-link" data-scroll-target="#fmri成像"><span class="header-section-number">1.6</span> fMRI成像</a></li>
  <li><a href="#地震和爆炸" id="toc-地震和爆炸" class="nav-link" data-scroll-target="#地震和爆炸"><span class="header-section-number">1.7</span> 地震和爆炸</a></li>
  </ul></li>
  <li><a href="#时间序列统计模型" id="toc-时间序列统计模型" class="nav-link" data-scroll-target="#时间序列统计模型"><span class="header-section-number">2</span> 时间序列统计模型</a>
  <ul class="collapse">
  <li><a href="#白噪声white-noise" id="toc-白噪声white-noise" class="nav-link" data-scroll-target="#白噪声white-noise"><span class="header-section-number">2.1</span> 白噪声(White Noise)</a></li>
  <li><a href="#移动平均值moving-averages和过滤filtering" id="toc-移动平均值moving-averages和过滤filtering" class="nav-link" data-scroll-target="#移动平均值moving-averages和过滤filtering"><span class="header-section-number">2.2</span> 移动平均值(Moving Averages)和过滤(Filtering)</a></li>
  <li><a href="#自回归autoregressions" id="toc-自回归autoregressions" class="nav-link" data-scroll-target="#自回归autoregressions"><span class="header-section-number">2.3</span> 自回归(Autoregressions)</a></li>
  <li><a href="#带漂移项drift的随机游走random-walk" id="toc-带漂移项drift的随机游走random-walk" class="nav-link" data-scroll-target="#带漂移项drift的随机游走random-walk"><span class="header-section-number">2.4</span> 带漂移项(Drift)的随机游走(Random Walk)</a></li>
  <li><a href="#噪声信号signal-in-noise" id="toc-噪声信号signal-in-noise" class="nav-link" data-scroll-target="#噪声信号signal-in-noise"><span class="header-section-number">2.5</span> 噪声信号(Signal in Noise)</a></li>
  </ul></li>
  <li><a href="#相关性测量" id="toc-相关性测量" class="nav-link" data-scroll-target="#相关性测量"><span class="header-section-number">3</span> 相关性测量</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>主要参考书籍为Shumway和Stoffer<span class="citation" data-cites="Shumway_2017">(<a href="#ref-Shumway_2017" role="doc-biblioref">2017</a>)</span>的Time Series Analysis and Its Applications: With R Examples。</p>
<p>该书第五版正在制作，配套<code>astsa</code>包中的部分数据集会逐渐更新，所以后期也许会换成第五版内容。</p>
<p>该内容为学习笔记，会很碎片化，同时参考了作者在<a href="https://github.com/nickpoison/tsa4/blob/master/textRcode.md">github</a>上给出的代码。</p>
<p>时间序列分析适用情境：</p>
<ul>
<li><strong>金融</strong>：每日股市配额、每月失业人口</li>
<li><strong>社会科学</strong>：人口序列</li>
<li><strong>流行病学</strong>：一段时间内流感人数</li>
<li><strong>药学</strong>：一段时间内血压测量</li>
<li><strong>fMRI</strong>：脑成像的时间序列 等</li>
</ul>
<p>两种不同但不一定互斥的时间序列分析方法：</p>
<ul>
<li><strong>时域方法</strong>(<em>time domain approach</em>)：对滞后关系的研究最重要(例如：今天发生的事如何影响明天将要发生的事)</li>
<li><strong>频域方法</strong>(<em>frequency domain approach</em>)：对周期的研究最重要(例如：繁荣和萧条时期是什么样的经济周期)</li>
</ul>
<section id="时间序列数据" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 时间序列数据</h1>
<section id="强生公司季度每股收益" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="强生公司季度每股收益"><span class="header-section-number">1.1</span> 强生公司季度每股收益</h2>
<p><code>jj</code>：强生公司的季度每股收益，从1960年第一季度到1980年最后一季度的84个季度(共21年)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(astsa)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>jj</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Qtr1      Qtr2      Qtr3      Qtr4
1960  0.710000  0.630000  0.850000  0.440000
1961  0.610000  0.690000  0.920000  0.550000
1962  0.720000  0.770000  0.920000  0.600000
1963  0.830000  0.800000  1.000000  0.770000
1964  0.920000  1.000000  1.240000  1.000000
1965  1.160000  1.300000  1.450000  1.250000
1966  1.260000  1.380000  1.860000  1.560000
1967  1.530000  1.590000  1.830000  1.860000
1968  1.530000  2.070000  2.340000  2.250000
1969  2.160000  2.430000  2.700000  2.250000
1970  2.790000  3.420000  3.690000  3.600000
1971  3.600000  4.320000  4.320000  4.050000
1972  4.860000  5.040000  5.040000  4.410000
1973  5.580000  5.850000  6.570000  5.310000
1974  6.030000  6.390000  6.930000  5.850000
1975  6.930000  7.740000  7.830000  6.120000
1976  7.740000  8.910000  8.280000  6.840000
1977  9.540000 10.260000  9.540000  8.729999
1978 11.880000 12.060000 12.150000  8.910000
1979 14.040000 12.960000 14.850000  9.990000
1980 16.200000 14.670000 16.020000 11.610000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(jj, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"o"</span>, <span class="at">xlab =</span> <span class="st">"时间"</span>, <span class="at">ylab =</span> <span class="st">"季度每股收益"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-强生公司季度每股收益" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-强生公司季度每股收益-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-强生公司季度每股收益-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-强生公司季度每股收益-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;1: 强生公司季度每股收益
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="全球变暖" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="全球变暖"><span class="header-section-number">1.2</span> 全球变暖</h2>
<p>这里我使用了最新数据，老数据<code>globtemp</code>计划被删除。</p>
<p><code>gtemp_land</code>：1850年到2023年，每年地球陆地年平均温度偏差(以摄氏度为单位，相对于1991-2020年的平均值)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gtemp_land</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 1850 
End = 2023 
Frequency = 1 
  [1] -0.50 -0.60 -0.50 -0.50 -0.20 -0.50 -0.80 -0.40 -0.40 -0.10 -0.70 -0.20
 [13] -0.50 -0.20 -0.30 -0.60 -0.40 -0.60 -0.30 -0.50 -0.20 -0.10 -0.40 -0.30
 [25] -0.40 -0.50 -0.20 -0.10  0.26 -0.20 -0.50 -0.40 -0.20 -0.40 -0.70 -0.40
 [37] -0.50 -0.30 -0.70  0.00 -0.20 -0.30 -0.50 -0.40  0.10 -0.50 -0.50 -0.70
 [49] -1.10 -0.50  0.00  0.21 -0.40  0.05 -0.60 -0.70 -0.30 -0.30 -0.80 -0.70
 [61] -0.50 -0.80 -0.70 -0.40 -0.10 -0.20 -0.50 -1.00 -0.30 -0.50  0.05 -0.10
 [73]  0.00 -0.30  0.01 -0.20  0.53 -0.60 -0.20 -0.30  0.21 -0.10 -0.10 -0.30
 [85] -0.30  0.13 -0.30 -0.40  0.38 -0.20  0.06 -0.10 -0.10  0.00  0.36  0.00
 [97]  0.00  0.32 -0.30  0.24  0.00 -0.20 -0.30  0.33 -0.30 -0.60 -0.20 -0.30
[109]  0.03  0.49 -0.90  0.08  0.36 -0.40 -0.30 -0.10 -0.10  0.19  0.80 -0.20
[121]  0.00  0.00  0.13  0.61  0.18  0.32 -0.20  0.29  0.37  0.10  0.19  0.85
[133]  0.00  0.64  0.36  0.42  0.67 -0.20  0.51  0.66  1.61  0.45  0.78  0.64
[145]  0.41  0.75  0.44  0.81  0.94  0.36  1.14  0.85  1.58  0.84  1.02  1.36
[157]  1.20  1.27  1.65  0.83  1.54  1.27  0.93  1.10  1.52  1.76  2.50  2.15
[169]  1.63  2.14  1.95  1.58  2.13  2.26</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(gtemp_land, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"o"</span>, <span class="at">xlab =</span> <span class="st">"时间"</span>, <span class="at">ylab =</span> <span class="st">"全球温度偏差/℃"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gm" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-gm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;2: 全球陆地年平均温度偏差(1850-2023)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="语音数据" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="语音数据"><span class="header-section-number">1.3</span> 语音数据</h2>
<p><code>speech</code>：为“aaa…hhh”这一短语录制的0.1秒(1000采样点)语音样本。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(speech)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$tsp
[1]    1 1020    1

$class
[1] "ts"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(speech)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-语音数据" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-语音数据-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-语音数据-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-语音数据-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;3: 10000点每秒速度采样的音节aaa···hhh的语音记录，n = 1020
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="道琼斯工业平均指数" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="道琼斯工业平均指数"><span class="header-section-number">1.4</span> 道琼斯工业平均指数</h2>
<p><code>djia</code>：从2006年4月20日到2016年4月20日，道琼斯工业平均指数的每日数值</p>
<p><code>djia</code>数据目前只使用其中的收盘价(<code>Close</code>，不确定是昨收还是今收，不过这也不重要)。</p>
<p>假设<span class="math inline">\(x_t\)</span>是实际值，则<span class="math inline">\(r_t=\frac{x_t-x_{t-1}}{x_{t-1}}\)</span>是收益率，那么<span class="math inline">\(1+r_t=\frac{x_t}{x_{t-1}}\)</span>，则有<span class="math inline">\(log(1+r_t)=log(\frac{x_t}{x_{t-1}})=log(x_t)-log(x_{t-1})\approx r_t\)</span>(<span class="math inline">\(r_t\)</span>很小，泰勒级数展开后成立)。</p>
<p><code>djiar</code>为2006年4月21日到2016年4月20日的日收益率。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>djiar <span class="ot">=</span> <span class="fu">diff</span>(<span class="fu">log</span>(djia<span class="sc">$</span>Close))[<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(djiar, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"DJIA Returns"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-djiar" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-djiar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-djiar-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-djiar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4: DJIA日收益率
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="厄尔尼诺和鱼群" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="厄尔尼诺和鱼群"><span class="header-section-number">1.5</span> 厄尔尼诺和鱼群</h2>
<p><code>soi</code>：1950-1987年间453个月的南方涛动指数(SOI)</p>
<p><code>rec</code>：1950-1987年间453个月的新鱼数量指数(Recruitment)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)) </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(soi, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"Southern Oscillation Index"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(rec, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"Recruitment"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-SOI" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SOI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-SOI-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SOI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;5: 每月SOI和新鱼数量指数
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="fmri成像" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="fmri成像"><span class="header-section-number">1.6</span> fMRI成像</h2>
<p><code>fmri1</code>：由8个位置的平均fMRI 血氧水平依赖(BOLD)信号组成的数据集。刺激持续32秒，然后停止32秒。信号周期为64秒，采样率为每2秒1次，采样时间为256秒(<span class="math inline">\(n=128\)</span>)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))  </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(fmri1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"BOLD"</span>, <span class="at">main =</span> <span class="st">"大脑皮层"</span>, <span class="at">spaghetti =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(fmri1[, <span class="dv">6</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"BOLD"</span>, <span class="at">main =</span> <span class="st">"丘脑和小脑"</span>, <span class="at">spaghetti =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fMRI" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fMRI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-fMRI-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fMRI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;6: 大脑皮层、丘脑、小脑各部位的fMRI数据
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(fmri1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">6</span>,.<span class="dv">6</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fMRI_each" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fMRI_each-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-fMRI_each-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fMRI_each-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;7: 分别展示
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">ts</span>(fmri1[, <span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">start =</span> <span class="dv">0</span>, <span class="at">freq =</span> <span class="dv">32</span>)         </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"大脑皮层"</span>, <span class="st">"丘脑"</span>, <span class="st">"小脑"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>u <span class="ot">=</span> <span class="fu">ts</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(.<span class="dv">6</span>, <span class="dv">16</span>), <span class="fu">rep</span>(<span class="sc">-</span>.<span class="dv">6</span>, <span class="dv">16</span>)), <span class="dv">4</span>), <span class="at">start =</span> <span class="dv">0</span>, <span class="at">freq =</span> <span class="dv">32</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){ </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tsplot</span>(x[, j<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)], <span class="at">ylab =</span> <span class="st">"BOLD"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">main =</span> names[i], <span class="at">col =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">6</span>, .<span class="dv">6</span>), </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">spaghetti =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">256</span>, <span class="dv">64</span>), <span class="at">side =</span> <span class="dv">1</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(u, <span class="at">type =</span> <span class="st">"s"</span>, <span class="at">col =</span> <span class="fu">gray</span>(.<span class="dv">3</span>)) </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"seconds"</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="fl">1.75</span>, <span class="at">cex =</span> .<span class="dv">9</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fMRI_each_2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fMRI_each_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-fMRI_each_2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fMRI_each_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;8: 包含刺激信息
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="地震和爆炸" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="地震和爆炸"><span class="header-section-number">1.7</span> 地震和爆炸</h2>
<p><code>EQ5</code>：某地区地震的纵波和横波(两阶段) <code>EXP6</code>：某地区爆炸的纵波和横波(两阶段)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(EQ5,  <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"地震"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(EXP6, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"爆炸"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-earthquakes" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-earthquakes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-earthquakes-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-earthquakes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;9: 地震和爆炸两阶段，1秒40个采样点
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="时间序列统计模型" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 时间序列统计模型</h1>
<section id="白噪声white-noise" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="白噪声white-noise"><span class="header-section-number">2.1</span> 白噪声(White Noise)</h2>
<p>白噪声：符合<span class="math inline">\(w_t\sim wn(0,\sigma_w^2)\)</span>的不相关随机变量</p>
<p>独立同分布(independent and identically distributed，iid)的噪声：<span class="math inline">\(w_t\sim iid(0,\sigma_w^2)\)</span></p>
<p>高斯白噪声(Gaussian white noise)：<span class="math inline">\(w_t\sim iidN(0,\sigma_w^2)\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">0</span>, <span class="dv">1</span>)                                   <span class="co"># 500 N(0,1) variates</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">filter</span>(w, <span class="at">sides =</span> <span class="dv">2</span>, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">3</span>))  <span class="co"># moving average</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(w, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"white noise"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(v, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">main =</span> <span class="st">"moving average"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-white_noise" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-white_noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-white_noise-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-white_noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;10: 高斯白噪声序列(上)和高斯白噪声序列的三点移动平均值(下)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="移动平均值moving-averages和过滤filtering" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="移动平均值moving-averages和过滤filtering"><span class="header-section-number">2.2</span> 移动平均值(Moving Averages)和过滤(Filtering)</h2>
<p>用移动平均值<span class="math inline">\(v_t\)</span>替换，从而对<span class="math inline">\(w_t\)</span>进行平滑处理。<a href="#fig-white_noise" class="quarto-xref">图&nbsp;10</a>下方图片就是三点移动平均值，其中<span class="math inline">\(v_t=\frac{1}{3}(w_{t-1}+w_t+w_{t+1})\)</span>。从实际效果来讲，实现了较慢的振荡被突出，较快的振荡被掩盖。这种序列一般称为<strong>滤波序列</strong>(<em>filtered series</em>)。</p>
<p><code>filter()</code>函数通俗来讲是用来消除噪声的(滤波)，生成<a href="#fig-white_noise" class="quarto-xref">图&nbsp;10</a>的代码中，参数<code>filter = rep(1/3, 3)</code>其实就是<code>filter = c(1/3, 1/3, 1/3)</code>，分别表示<span class="math inline">\(w_{t+1}\)</span>、<span class="math inline">\(w_t\)</span>和<span class="math inline">\(w_{t-1}\)</span>的系数。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(x,                <span class="co"># ts数据</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>       filter,           <span class="co"># 一个逆时间顺序的滤波器系数向量</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"convolution"</span>, <span class="st">"recursive"</span>), <span class="co"># 卷积和递归，卷积是移动平均，递归是自回归，默认卷积</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">sides =</span> <span class="dv">2</span>,        <span class="co"># 只用于卷积，1表示单边滤波(只考虑前面的值)，2表示双边滤波(两边都考虑)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">circular =</span> F,     <span class="co"># 只用于卷积，是否末尾和开头相连</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>       init)             <span class="co"># 只用于递归，初始值，默认0</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="自回归autoregressions" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="自回归autoregressions"><span class="header-section-number">2.3</span> 自回归(Autoregressions)</h2>
<p>可以换种方式替换<span class="math inline">\(w_t\)</span>，即<span class="math inline">\(x_t=x_{t-1}-0.9x_{t-2}+w_t\)</span>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">550</span>,<span class="dv">0</span>,<span class="dv">1</span>)  <span class="co"># 50 extra to avoid startup problems</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">filter</span>(w, <span class="at">filter =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span>.<span class="dv">9</span>), <span class="at">method =</span> <span class="st">"recursive"</span>)[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(x, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"自回归"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-autoregressions" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autoregressions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-autoregressions-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-autoregressions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;11: 自回归序列
</figcaption>
</figure>
</div>
</div>
</div>
<p>生成<a href="#fig-autoregressions" class="quarto-xref">图&nbsp;11</a>的代码中，<code>init</code>参数默认为0，即<span class="math inline">\(x_1=w_1\)</span>、<span class="math inline">\(x_2=x_1+w_2=w_1+w_2\)</span>，之后<span class="math inline">\(x_3=x_2-0.9x_1+w_3\)</span>。<span class="math inline">\(x_1\)</span>和<span class="math inline">\(x_2\)</span>显然是不符合要求的，常用方法是去除这一部分，生成<a href="#fig-autoregressions" class="quarto-xref">图&nbsp;11</a>的代码中多生成了50个数据，之后去除了。</p>
</section>
<section id="带漂移项drift的随机游走random-walk" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="带漂移项drift的随机游走random-walk"><span class="header-section-number">2.4</span> 带漂移项(Drift)的随机游走(Random Walk)</h2>
<p>带漂移项的随机游走模型适合处理<a href="#fig-gm" class="quarto-xref">图&nbsp;2</a>所展示的全球变暖相关数据。该模型中</p>
<p><span id="eq-rw"><span class="math display">\[
x_t=\delta+x_{t-1}+w_t
\tag{1}\]</span></span></p>
<p>其中<span class="math inline">\(t=1,\ 2,\ \cdots\)</span>，<span class="math inline">\(x_0=0\)</span>，<span class="math inline">\(w_t\)</span>为白噪声，常数<span class="math inline">\(\delta\)</span>为漂移项。当<span class="math inline">\(\delta=0\)</span>时，<a href="#eq-rw" class="quarto-xref">式&nbsp;1</a>为随机游走。</p>
<p><a href="#eq-rw" class="quarto-xref">式&nbsp;1</a>还可以转化为<span class="math inline">\(x_t=\delta t+\sum_{j=1}^{t}w_j\)</span>，可见当<span class="math inline">\(\delta=0\)</span>时，<span class="math inline">\(x_t\)</span>就是白噪声累加和。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">154</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">cumsum</span>(w)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">=</span> w <span class="sc">+</span> .<span class="dv">2</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>xd <span class="ot">=</span> <span class="fu">cumsum</span>(wd)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(xd, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">55</span>), <span class="at">main =</span> <span class="st">"random walk"</span>, <span class="at">ylab =</span> <span class="st">''</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="at">col =</span> <span class="dv">4</span>) </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">clip</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> .<span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rw" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-rw-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;12: 随机游走图
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-rw" class="quarto-xref">图&nbsp;12</a>中<span class="math inline">\(\sigma_w=1\)</span>，黑色实线的漂移项<span class="math inline">\(\delta=0.2\)</span>，黑色虚线是斜率为0.2的直线，蓝色实线为随机游走(无漂移项，即<span class="math inline">\(\delta=0\)</span>)，蓝色虚线表示<span class="math inline">\(y=0\)</span>的直线。</p>
</section>
<section id="噪声信号signal-in-noise" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="噪声信号signal-in-noise"><span class="header-section-number">2.5</span> 噪声信号(Signal in Noise)</h2>
<p>很多时间序列模型都是假设由固定周期性变化的信号和随机噪声叠加构成的，<a href="#fig-fMRI" class="quarto-xref">图&nbsp;6</a>说表示的fMRI序列就有很明显的周期性。</p>
<p>现在令：</p>
<p><span id="eq-cos"><span class="math display">\[
x_t=2\cos(2\pi\frac{t+15}{50})+w_t
\tag{2}\]</span></span></p>
<p>其中<span class="math inline">\(t=1,\ 2,\ \cdots,\ 500\)</span>，第一项<span class="math inline">\(2\cos(2\pi\frac{t+15}{50})\)</span>就是信号。</p>
<p>正弦波形还可以写成：</p>
<p><span class="math display">\[
A\cos(2\pi\omega t+\phi)
\]</span></p>
<p>其中<span class="math inline">\(A\)</span>是振幅，<span class="math inline">\(\omega\)</span>是振荡频率，<span class="math inline">\(\phi\)</span>是相位。<a href="#eq-cos" class="quarto-xref">式&nbsp;2</a>中<span class="math inline">\(A=2\)</span>，<span class="math inline">\(\omega=\frac{1}{50}\)</span>(50个时间点为一个周期)，<span class="math inline">\(\phi=\frac{2\pi15}{50}=0.6\pi\)</span>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(cs, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="fu">expression</span>(x[t] <span class="sc">==</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> t <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi)))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(cs <span class="sc">+</span> w, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="fu">expression</span>(x[t] <span class="sc">==</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> t <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi) <span class="sc">+</span> <span class="fu">N</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(cs <span class="sc">+</span> <span class="dv">5</span> <span class="sc">*</span> w, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="fu">expression</span>(x[t] <span class="sc">==</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> t <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi) <span class="sc">+</span> <span class="fu">N</span>(<span class="dv">0</span>, <span class="dv">25</span>)))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cos" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-cos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13: 余弦波和可加性高斯白噪声污染的余弦图
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-cos" class="quarto-xref">图&nbsp;13</a>中间的图和下面的图分别加上了<span class="math inline">\(\sigma_w=1\)</span>和<span class="math inline">\(\sigma_w=5\)</span>的白噪声。信号被遮掩的程度取决于信号幅度和<span class="math inline">\(\sigma_w\)</span>的大小。信号幅度和<span class="math inline">\(\sigma_w\)</span>之比称为信噪比(signal-to-noise ratio，SNR)。SNR越大，检测信号就越容易，反之越难。例如<a href="#fig-cos" class="quarto-xref">图&nbsp;13</a>中，中间的图就比较容易看出信号，下面的图就比较困难。通常我们关心的是信号。</p>
</section>
</section>
<section id="相关性测量" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 相关性测量</h1>
<p>相关性是时间序列分析的基本特征，所以最常用的描述性度量是用协方差和相关函数表示。</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">参考文献</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-Shumway_2017" class="csl-entry" role="listitem">
Shumway, R. H., &amp; Stoffer, D. S. (2017). <em>Time series analysis and its applications: With r examples</em> (4th ed.). Springer Cham. <a href="https://doi.org/10.1007/978-3-319-52452-8">https://doi.org/10.1007/978-3-319-52452-8</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>