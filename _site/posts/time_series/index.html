<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="周博霖">
<meta name="dcterms.date" content="2024-08-10">

<title>Zhou Bolin’s blog - 时间序列分析：第一章</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Zhou Bolin’s blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">个人简介</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zhoubolin0404"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">时间序列分析：第一章</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">学习笔记</div>
                <div class="quarto-category">统计方法</div>
                <div class="quarto-category">时间序列分析</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">作者</div>
      <div class="quarto-title-meta-contents">
               <p>周博霖 </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">发布于</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 10, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">修改于</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">September 2, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">该页面内容</h2>
   
  <ul class="collapse">
  <li><a href="#时间序列数据" id="toc-时间序列数据" class="nav-link active" data-scroll-target="#时间序列数据"><span class="header-section-number">1</span> 时间序列数据</a>
  <ul class="collapse">
  <li><a href="#强生公司季度每股收益" id="toc-强生公司季度每股收益" class="nav-link" data-scroll-target="#强生公司季度每股收益"><span class="header-section-number">1.1</span> 强生公司季度每股收益</a></li>
  <li><a href="#全球变暖" id="toc-全球变暖" class="nav-link" data-scroll-target="#全球变暖"><span class="header-section-number">1.2</span> 全球变暖</a></li>
  <li><a href="#语音数据" id="toc-语音数据" class="nav-link" data-scroll-target="#语音数据"><span class="header-section-number">1.3</span> 语音数据</a></li>
  <li><a href="#道琼斯工业平均指数" id="toc-道琼斯工业平均指数" class="nav-link" data-scroll-target="#道琼斯工业平均指数"><span class="header-section-number">1.4</span> 道琼斯工业平均指数</a></li>
  <li><a href="#厄尔尼诺和鱼群" id="toc-厄尔尼诺和鱼群" class="nav-link" data-scroll-target="#厄尔尼诺和鱼群"><span class="header-section-number">1.5</span> 厄尔尼诺和鱼群</a></li>
  <li><a href="#fmri成像" id="toc-fmri成像" class="nav-link" data-scroll-target="#fmri成像"><span class="header-section-number">1.6</span> fMRI成像</a></li>
  <li><a href="#地震和爆炸" id="toc-地震和爆炸" class="nav-link" data-scroll-target="#地震和爆炸"><span class="header-section-number">1.7</span> 地震和爆炸</a></li>
  </ul></li>
  <li><a href="#时间序列统计模型" id="toc-时间序列统计模型" class="nav-link" data-scroll-target="#时间序列统计模型"><span class="header-section-number">2</span> 时间序列统计模型</a>
  <ul class="collapse">
  <li><a href="#sec-whitenoise" id="toc-sec-whitenoise" class="nav-link" data-scroll-target="#sec-whitenoise"><span class="header-section-number">2.1</span> 白噪声(White Noise)</a></li>
  <li><a href="#sec-moveave" id="toc-sec-moveave" class="nav-link" data-scroll-target="#sec-moveave"><span class="header-section-number">2.2</span> 移动平均值(Moving Averages)和过滤(Filtering)</a></li>
  <li><a href="#sec-autoregressions" id="toc-sec-autoregressions" class="nav-link" data-scroll-target="#sec-autoregressions"><span class="header-section-number">2.3</span> 自回归(Autoregressions)</a></li>
  <li><a href="#带漂移项drift的随机游走random-walk" id="toc-带漂移项drift的随机游走random-walk" class="nav-link" data-scroll-target="#带漂移项drift的随机游走random-walk"><span class="header-section-number">2.4</span> 带漂移项(Drift)的随机游走(Random Walk)</a></li>
  <li><a href="#噪声信号signal-in-noise" id="toc-噪声信号signal-in-noise" class="nav-link" data-scroll-target="#噪声信号signal-in-noise"><span class="header-section-number">2.5</span> 噪声信号(Signal in Noise)</a></li>
  </ul></li>
  <li><a href="#相关性测量" id="toc-相关性测量" class="nav-link" data-scroll-target="#相关性测量"><span class="header-section-number">3</span> 相关性测量</a>
  <ul class="collapse">
  <li><a href="#平均函数" id="toc-平均函数" class="nav-link" data-scroll-target="#平均函数"><span class="header-section-number">3.1</span> 平均函数</a></li>
  <li><a href="#自协方差函数autocovariance-function" id="toc-自协方差函数autocovariance-function" class="nav-link" data-scroll-target="#自协方差函数autocovariance-function"><span class="header-section-number">3.2</span> 自协方差函数(Autocovariance Function)</a></li>
  <li><a href="#自相关函数autocorrelation-functionacf" id="toc-自相关函数autocorrelation-functionacf" class="nav-link" data-scroll-target="#自相关函数autocorrelation-functionacf"><span class="header-section-number">3.3</span> 自相关函数(Autocorrelation Function，ACF)</a></li>
  </ul></li>
  <li><a href="#平稳时间序列stationary-time-series" id="toc-平稳时间序列stationary-time-series" class="nav-link" data-scroll-target="#平稳时间序列stationary-time-series"><span class="header-section-number">4</span> 平稳时间序列(Stationary Time Series)</a>
  <ul class="collapse">
  <li><a href="#严格平稳strictly-stationary" id="toc-严格平稳strictly-stationary" class="nav-link" data-scroll-target="#严格平稳strictly-stationary"><span class="header-section-number">4.1</span> 严格平稳(Strictly Stationary)</a></li>
  <li><a href="#弱平稳weakly-stationary" id="toc-弱平稳weakly-stationary" class="nav-link" data-scroll-target="#弱平稳weakly-stationary"><span class="header-section-number">4.2</span> 弱平稳(Weakly Stationary)</a></li>
  <li><a href="#联合平稳jointly-stationary" id="toc-联合平稳jointly-stationary" class="nav-link" data-scroll-target="#联合平稳jointly-stationary"><span class="header-section-number">4.3</span> 联合平稳(Jointly Stationary)</a></li>
  <li><a href="#线性随机过程linear-process" id="toc-线性随机过程linear-process" class="nav-link" data-scroll-target="#线性随机过程linear-process"><span class="header-section-number">4.4</span> 线性(随机)过程(Linear Process)</a></li>
  </ul></li>
  <li><a href="#相关系数的估计" id="toc-相关系数的估计" class="nav-link" data-scroll-target="#相关系数的估计"><span class="header-section-number">5</span> 相关系数的估计</a>
  <ul class="collapse">
  <li><a href="#样本自协方差函数sample-autocovariance-function" id="toc-样本自协方差函数sample-autocovariance-function" class="nav-link" data-scroll-target="#样本自协方差函数sample-autocovariance-function"><span class="header-section-number">5.1</span> 样本自协方差函数(Sample Autocovariance Function)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>主要参考书籍为Shumway和Stoffer<span class="citation" data-cites="Shumway_2017">(<a href="#ref-Shumway_2017" role="doc-biblioref">2017</a>)</span>的Time Series Analysis and Its Applications: With R Examples。</p>
<p>该书第五版正在制作，配套<code>astsa</code>包中的部分数据集会逐渐更新，所以后期也许会换成第五版内容。</p>
<p>该内容为学习笔记，会很碎片化，同时参考了作者在<a href="https://github.com/nickpoison/tsa4/blob/master/textRcode.md">github</a>上给出的代码。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>该框表明这部分完全是个人理解，可能有误。</p>
<p>一切错误和想讨论的内容欢迎联系邮箱(zhoubolin0404@126.com)，感谢！</p>
</div>
</div>
<p>时间序列分析适用情境：</p>
<ul>
<li><strong>金融</strong>：每日股市配额、每月失业人口</li>
<li><strong>社会科学</strong>：人口序列</li>
<li><strong>流行病学</strong>：一段时间内流感人数</li>
<li><strong>药学</strong>：一段时间内血压测量</li>
<li><strong>fMRI</strong>：脑成像的时间序列 等</li>
</ul>
<p>两种不同但不一定互斥的时间序列分析方法：</p>
<ul>
<li><strong>时域方法</strong>(<em>time domain approach</em>)：对滞后关系的研究最重要(例如：今天发生的事如何影响明天将要发生的事)</li>
<li><strong>频域方法</strong>(<em>frequency domain approach</em>)：对周期的研究最重要(例如：繁荣和萧条时期是什么样的经济周期)</li>
</ul>
<section id="时间序列数据" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 时间序列数据</h1>
<section id="强生公司季度每股收益" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="强生公司季度每股收益"><span class="header-section-number">1.1</span> 强生公司季度每股收益</h2>
<p><code>jj</code>：强生公司的季度每股收益，从1960年第一季度到1980年最后一季度的84个季度(共21年)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(astsa)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>jj</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Qtr1      Qtr2      Qtr3      Qtr4
1960  0.710000  0.630000  0.850000  0.440000
1961  0.610000  0.690000  0.920000  0.550000
1962  0.720000  0.770000  0.920000  0.600000
1963  0.830000  0.800000  1.000000  0.770000
1964  0.920000  1.000000  1.240000  1.000000
1965  1.160000  1.300000  1.450000  1.250000
1966  1.260000  1.380000  1.860000  1.560000
1967  1.530000  1.590000  1.830000  1.860000
1968  1.530000  2.070000  2.340000  2.250000
1969  2.160000  2.430000  2.700000  2.250000
1970  2.790000  3.420000  3.690000  3.600000
1971  3.600000  4.320000  4.320000  4.050000
1972  4.860000  5.040000  5.040000  4.410000
1973  5.580000  5.850000  6.570000  5.310000
1974  6.030000  6.390000  6.930000  5.850000
1975  6.930000  7.740000  7.830000  6.120000
1976  7.740000  8.910000  8.280000  6.840000
1977  9.540000 10.260000  9.540000  8.729999
1978 11.880000 12.060000 12.150000  8.910000
1979 14.040000 12.960000 14.850000  9.990000
1980 16.200000 14.670000 16.020000 11.610000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(jj, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"o"</span>, <span class="at">xlab =</span> <span class="st">"时间"</span>, <span class="at">ylab =</span> <span class="st">"季度每股收益"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-强生公司季度每股收益" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-强生公司季度每股收益-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-强生公司季度每股收益-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-强生公司季度每股收益-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;1: 强生公司季度每股收益
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="全球变暖" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="全球变暖"><span class="header-section-number">1.2</span> 全球变暖</h2>
<p>这里我使用了最新数据，老数据<code>globtemp</code>计划被删除。</p>
<p><code>gtemp_land</code>：1850年到2023年，每年地球陆地年平均温度偏差(以摄氏度为单位，相对于1991-2020年的平均值)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gtemp_land</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 1850 
End = 2023 
Frequency = 1 
  [1] -0.50 -0.60 -0.50 -0.50 -0.20 -0.50 -0.80 -0.40 -0.40 -0.10 -0.70 -0.20
 [13] -0.50 -0.20 -0.30 -0.60 -0.40 -0.60 -0.30 -0.50 -0.20 -0.10 -0.40 -0.30
 [25] -0.40 -0.50 -0.20 -0.10  0.26 -0.20 -0.50 -0.40 -0.20 -0.40 -0.70 -0.40
 [37] -0.50 -0.30 -0.70  0.00 -0.20 -0.30 -0.50 -0.40  0.10 -0.50 -0.50 -0.70
 [49] -1.10 -0.50  0.00  0.21 -0.40  0.05 -0.60 -0.70 -0.30 -0.30 -0.80 -0.70
 [61] -0.50 -0.80 -0.70 -0.40 -0.10 -0.20 -0.50 -1.00 -0.30 -0.50  0.05 -0.10
 [73]  0.00 -0.30  0.01 -0.20  0.53 -0.60 -0.20 -0.30  0.21 -0.10 -0.10 -0.30
 [85] -0.30  0.13 -0.30 -0.40  0.38 -0.20  0.06 -0.10 -0.10  0.00  0.36  0.00
 [97]  0.00  0.32 -0.30  0.24  0.00 -0.20 -0.30  0.33 -0.30 -0.60 -0.20 -0.30
[109]  0.03  0.49 -0.90  0.08  0.36 -0.40 -0.30 -0.10 -0.10  0.19  0.80 -0.20
[121]  0.00  0.00  0.13  0.61  0.18  0.32 -0.20  0.29  0.37  0.10  0.19  0.85
[133]  0.00  0.64  0.36  0.42  0.67 -0.20  0.51  0.66  1.61  0.45  0.78  0.64
[145]  0.41  0.75  0.44  0.81  0.94  0.36  1.14  0.85  1.58  0.84  1.02  1.36
[157]  1.20  1.27  1.65  0.83  1.54  1.27  0.93  1.10  1.52  1.76  2.50  2.15
[169]  1.63  2.14  1.95  1.58  2.13  2.26</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(gtemp_land, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"o"</span>, <span class="at">xlab =</span> <span class="st">"时间"</span>, <span class="at">ylab =</span> <span class="st">"全球温度偏差/℃"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gm" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-gm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;2: 全球陆地年平均温度偏差(1850-2023)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="语音数据" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="语音数据"><span class="header-section-number">1.3</span> 语音数据</h2>
<p><code>speech</code>：为“aaa…hhh”这一短语录制的0.1秒(1000采样点)语音样本。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(speech)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$tsp
[1]    1 1020    1

$class
[1] "ts"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(speech)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-语音数据" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-语音数据-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-语音数据-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-语音数据-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;3: 10000点每秒速度采样的音节aaa···hhh的语音记录，n = 1020
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="道琼斯工业平均指数" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="道琼斯工业平均指数"><span class="header-section-number">1.4</span> 道琼斯工业平均指数</h2>
<p><code>djia</code>：从2006年4月20日到2016年4月20日，道琼斯工业平均指数的每日数值</p>
<p><code>djia</code>数据目前只使用其中的收盘价(<code>Close</code>，不确定是昨收还是今收，不过这也不重要)。</p>
<p>假设<span class="math inline">\(x_t\)</span>是实际值，则<span class="math inline">\(r_t=\frac{x_t-x_{t-1}}{x_{t-1}}\)</span>是收益率，那么<span class="math inline">\(1+r_t=\frac{x_t}{x_{t-1}}\)</span>，则有<span class="math inline">\(log(1+r_t)=log(\frac{x_t}{x_{t-1}})=log(x_t)-log(x_{t-1})\approx r_t\)</span>(<span class="math inline">\(r_t\)</span>很小，泰勒级数展开后成立)。</p>
<p><code>djiar</code>为2006年4月21日到2016年4月20日的日收益率。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>djiar <span class="ot">=</span> <span class="fu">diff</span>(<span class="fu">log</span>(djia<span class="sc">$</span>Close))[<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(djiar, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"DJIA Returns"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-djiar" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-djiar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-djiar-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-djiar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4: DJIA日收益率
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="厄尔尼诺和鱼群" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="厄尔尼诺和鱼群"><span class="header-section-number">1.5</span> 厄尔尼诺和鱼群</h2>
<p><code>soi</code>：1950-1987年间453个月的南方涛动指数(SOI)</p>
<p><code>rec</code>：1950-1987年间453个月的新鱼数量指数(Recruitment)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)) </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(soi, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"Southern Oscillation Index"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(rec, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"Recruitment"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-SOI" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SOI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-SOI-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SOI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;5: 每月SOI和新鱼数量指数
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="fmri成像" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="fmri成像"><span class="header-section-number">1.6</span> fMRI成像</h2>
<p><code>fmri1</code>：由8个位置的平均fMRI 血氧水平依赖(BOLD)信号组成的数据集。刺激持续32秒，然后停止32秒。信号周期为64秒，采样率为每2秒1次，采样时间为256秒(<span class="math inline">\(n=128\)</span>)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))  </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(fmri1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"BOLD"</span>, <span class="at">main =</span> <span class="st">"大脑皮层"</span>, <span class="at">spaghetti =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(fmri1[, <span class="dv">6</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ylab =</span> <span class="st">"BOLD"</span>, <span class="at">main =</span> <span class="st">"丘脑和小脑"</span>, <span class="at">spaghetti =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fMRI" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fMRI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-fMRI-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fMRI-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;6: 大脑皮层、丘脑、小脑各部位的fMRI数据
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(fmri1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">6</span>,.<span class="dv">6</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fMRI_each" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fMRI_each-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-fMRI_each-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fMRI_each-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;7: 分别展示
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">ts</span>(fmri1[, <span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">start =</span> <span class="dv">0</span>, <span class="at">freq =</span> <span class="dv">32</span>)         </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"大脑皮层"</span>, <span class="st">"丘脑"</span>, <span class="st">"小脑"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>u <span class="ot">=</span> <span class="fu">ts</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(.<span class="dv">6</span>, <span class="dv">16</span>), <span class="fu">rep</span>(<span class="sc">-</span>.<span class="dv">6</span>, <span class="dv">16</span>)), <span class="dv">4</span>), <span class="at">start =</span> <span class="dv">0</span>, <span class="at">freq =</span> <span class="dv">32</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){ </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tsplot</span>(x[, j<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)], <span class="at">ylab =</span> <span class="st">"BOLD"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">main =</span> names[i], <span class="at">col =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">6</span>, .<span class="dv">6</span>), </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">spaghetti =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">256</span>, <span class="dv">64</span>), <span class="at">side =</span> <span class="dv">1</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(u, <span class="at">type =</span> <span class="st">"s"</span>, <span class="at">col =</span> <span class="fu">gray</span>(.<span class="dv">3</span>)) </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"seconds"</span>, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="fl">1.75</span>, <span class="at">cex =</span> .<span class="dv">9</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fMRI_each_2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fMRI_each_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-fMRI_each_2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fMRI_each_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;8: 包含刺激信息
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="地震和爆炸" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="地震和爆炸"><span class="header-section-number">1.7</span> 地震和爆炸</h2>
<p><code>EQ5</code>：某地区地震的纵波和横波(两阶段) <code>EXP6</code>：某地区爆炸的纵波和横波(两阶段)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(EQ5,  <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"地震"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(EXP6, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"爆炸"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-earthquakes" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-earthquakes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-earthquakes-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-earthquakes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;9: 地震和爆炸两阶段，1秒40个采样点
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="时间序列统计模型" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 时间序列统计模型</h1>
<section id="sec-whitenoise" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-whitenoise"><span class="header-section-number">2.1</span> 白噪声(White Noise)</h2>
<p>白噪声：符合<span class="math inline">\(w_t\sim wn(0,\sigma_w^2)\)</span>的不相关随机变量</p>
<p>独立同分布(independent and identically distributed，iid)的噪声：<span class="math inline">\(w_t\sim iid(0,\sigma_w^2)\)</span></p>
<p>高斯白噪声(Gaussian white noise)：<span class="math inline">\(w_t\sim iidN(0,\sigma_w^2)\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">0</span>, <span class="dv">1</span>)                                   <span class="co"># 500 N(0,1) variates</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">filter</span>(w, <span class="at">sides =</span> <span class="dv">2</span>, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">3</span>))  <span class="co"># moving average</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(w, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"white noise"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(v, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">main =</span> <span class="st">"moving average"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-white_noise" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-white_noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-white_noise-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-white_noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;10: 高斯白噪声序列(上)和高斯白噪声序列的三点移动平均值(下)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-moveave" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sec-moveave"><span class="header-section-number">2.2</span> 移动平均值(Moving Averages)和过滤(Filtering)</h2>
<p>用移动平均值<span class="math inline">\(v_t\)</span>替换，从而对<span class="math inline">\(w_t\)</span>进行平滑处理。<a href="#fig-white_noise" class="quarto-xref">图&nbsp;10</a>下方图片就是三点移动平均值，其中<span class="math inline">\(v_t=\frac{1}{3}(w_{t-1}+w_t+w_{t+1})\)</span>。从实际效果来讲，实现了较慢的振荡被突出，较快的振荡被掩盖。这种序列一般称为<strong>滤波序列</strong>(<em>filtered series</em>)。</p>
<p><code>filter()</code>函数通俗来讲是用来消除噪声的(滤波)，生成<a href="#fig-white_noise" class="quarto-xref">图&nbsp;10</a>的代码中，参数<code>filter = rep(1/3, 3)</code>其实就是<code>filter = c(1/3, 1/3, 1/3)</code>，分别表示<span class="math inline">\(w_{t+1}\)</span>、<span class="math inline">\(w_t\)</span>和<span class="math inline">\(w_{t-1}\)</span>的系数。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(x,                <span class="co"># ts数据</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>       filter,           <span class="co"># 一个逆时间顺序的滤波器系数向量</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"convolution"</span>, <span class="st">"recursive"</span>), <span class="co"># 卷积和递归，卷积是移动平均，递归是自回归，默认卷积</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">sides =</span> <span class="dv">2</span>,        <span class="co"># 只用于卷积，1表示单边滤波(只考虑前面的值)，2表示双边滤波(两边都考虑)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">circular =</span> F,     <span class="co"># 只用于卷积，是否末尾和开头相连</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>       init)             <span class="co"># 只用于递归，初始值，默认0</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-autoregressions" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-autoregressions"><span class="header-section-number">2.3</span> 自回归(Autoregressions)</h2>
<p>可以换种方式替换<span class="math inline">\(w_t\)</span>，即<span class="math inline">\(x_t=x_{t-1}-0.9x_{t-2}+w_t\)</span>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">550</span>,<span class="dv">0</span>,<span class="dv">1</span>)  <span class="co"># 50 extra to avoid startup problems</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">filter</span>(w, <span class="at">filter =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span>.<span class="dv">9</span>), <span class="at">method =</span> <span class="st">"recursive"</span>)[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(x, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">main =</span> <span class="st">"自回归"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-autoregressions" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autoregressions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-autoregressions-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-autoregressions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;11: 自回归序列
</figcaption>
</figure>
</div>
</div>
</div>
<p>生成<a href="#fig-autoregressions" class="quarto-xref">图&nbsp;11</a>的代码中，<code>init</code>参数默认为0，即<span class="math inline">\(x_1=w_1\)</span>、<span class="math inline">\(x_2=x_1+w_2=w_1+w_2\)</span>，之后<span class="math inline">\(x_3=x_2-0.9x_1+w_3\)</span>。<span class="math inline">\(x_1\)</span>和<span class="math inline">\(x_2\)</span>显然是不符合要求的，常用方法是去除这一部分，生成<a href="#fig-autoregressions" class="quarto-xref">图&nbsp;11</a>的代码中多生成了50个数据，之后去除了。</p>
</section>
<section id="带漂移项drift的随机游走random-walk" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="带漂移项drift的随机游走random-walk"><span class="header-section-number">2.4</span> 带漂移项(Drift)的随机游走(Random Walk)</h2>
<p>带漂移项的随机游走模型适合处理<a href="#fig-gm" class="quarto-xref">图&nbsp;2</a>所展示的全球变暖相关数据。该模型中</p>
<p><span id="eq-rw"><span class="math display">\[
x_t=\delta+x_{t-1}+w_t
\tag{1}\]</span></span></p>
<p>其中<span class="math inline">\(t=1,\ 2,\ \cdots\)</span>，<span class="math inline">\(x_0=0\)</span>，<span class="math inline">\(w_t\)</span>为白噪声，常数<span class="math inline">\(\delta\)</span>为漂移项。当<span class="math inline">\(\delta=0\)</span>时，<a href="#eq-rw" class="quarto-xref">式&nbsp;1</a>为随机游走。</p>
<p><a href="#eq-rw" class="quarto-xref">式&nbsp;1</a>还可以转化为<span class="math inline">\(x_t=\delta t+\sum_{j=1}^{t}w_j\)</span>，可见当<span class="math inline">\(\delta=0\)</span>时，<span class="math inline">\(x_t\)</span>就是白噪声累加和。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">154</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">cumsum</span>(w)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">=</span> w <span class="sc">+</span> .<span class="dv">2</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>xd <span class="ot">=</span> <span class="fu">cumsum</span>(wd)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(xd, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">55</span>), <span class="at">main =</span> <span class="st">"random walk"</span>, <span class="at">ylab =</span> <span class="st">''</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="at">col =</span> <span class="dv">4</span>) </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">clip</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> .<span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rw" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-rw-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;12: 随机游走图
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-rw" class="quarto-xref">图&nbsp;12</a>中<span class="math inline">\(\sigma_w=1\)</span>，黑色实线的漂移项<span class="math inline">\(\delta=0.2\)</span>，黑色虚线是斜率为0.2的直线，蓝色实线为随机游走(无漂移项，即<span class="math inline">\(\delta=0\)</span>)，蓝色虚线表示<span class="math inline">\(y=0\)</span>的直线。</p>
</section>
<section id="噪声信号signal-in-noise" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="噪声信号signal-in-noise"><span class="header-section-number">2.5</span> 噪声信号(Signal in Noise)</h2>
<p>很多时间序列模型都是假设由固定周期性变化的信号和随机噪声叠加构成的，<a href="#fig-fMRI" class="quarto-xref">图&nbsp;6</a>所表示的fMRI序列就有很明显的周期性。</p>
<p>现在令：</p>
<p><span id="eq-cos"><span class="math display">\[
x_t=2\cos(2\pi\frac{t+15}{50})+w_t
\tag{2}\]</span></span></p>
<p>其中<span class="math inline">\(t=1,\ 2,\ \cdots,\ 500\)</span>，第一项<span class="math inline">\(2\cos(2\pi\frac{t+15}{50})\)</span>就是信号。</p>
<p>正弦波形还可以写成：</p>
<p><span class="math display">\[
A\cos(2\pi\omega t+\phi)
\]</span></p>
<p>其中<span class="math inline">\(A\)</span>是振幅，<span class="math inline">\(\omega\)</span>是振荡频率，<span class="math inline">\(\phi\)</span>是相位。<a href="#eq-cos" class="quarto-xref">式&nbsp;2</a>中<span class="math inline">\(A=2\)</span>，<span class="math inline">\(\omega=\frac{1}{50}\)</span>(50个时间点为一个周期)，<span class="math inline">\(\phi=\frac{2\pi15}{50}=0.6\pi\)</span>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(cs, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="fu">expression</span>(x[t] <span class="sc">==</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> t <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi)))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(cs <span class="sc">+</span> w, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="fu">expression</span>(x[t] <span class="sc">==</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> t <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi) <span class="sc">+</span> <span class="fu">N</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tsplot</span>(cs <span class="sc">+</span> <span class="dv">5</span> <span class="sc">*</span> w, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="fu">expression</span>(x[t] <span class="sc">==</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> t <span class="sc">/</span> <span class="dv">50</span> <span class="sc">+</span> .<span class="dv">6</span> <span class="sc">*</span> pi) <span class="sc">+</span> <span class="fu">N</span>(<span class="dv">0</span>, <span class="dv">25</span>)))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cos" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-cos-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13: 余弦波和可加性高斯白噪声污染的余弦图
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-cos" class="quarto-xref">图&nbsp;13</a>中间的图和下面的图分别加上了<span class="math inline">\(\sigma_w=1\)</span>和<span class="math inline">\(\sigma_w=5\)</span>的白噪声。信号被遮掩的程度取决于信号幅度和<span class="math inline">\(\sigma_w\)</span>的大小。信号幅度和<span class="math inline">\(\sigma_w\)</span>之比称为信噪比(signal-to-noise ratio，SNR)。SNR越大，检测信号就越容易，反之越难。例如<a href="#fig-cos" class="quarto-xref">图&nbsp;13</a>中，中间的图就比较容易看出信号，下面的图就比较困难。通常我们关心的是信号。</p>
</section>
</section>
<section id="相关性测量" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 相关性测量</h1>
<p>相关性是时间序列分析的基本特征，所以最常用的描述性度量是协方差和相关函数。边际分布函数<span class="math inline">\(F_t(x)=P\{x_t\leq x\}\)</span>、相应的边际密度函数<span class="math inline">\(f_t(x)=\frac{\partial F_t(x)}{\partial x}\)</span>和平均函数都是有用的边际描述指标。</p>
<section id="平均函数" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="平均函数"><span class="header-section-number">3.1</span> 平均函数</h2>
<p><span id="eq-meanf"><span class="math display">\[
\mu_{xt}=\operatorname{E}(x_t)=\int_{-\infty}^{\infty}xf_t(x)\operatorname{d}x
\tag{3}\]</span></span></p>
<section id="sec-movemean" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="sec-movemean"><span class="header-section-number">3.1.1</span> 移动平均序列的平均函数</h3>
<p>平均函数和白噪声相同，以<a href="#fig-white_noise" class="quarto-xref">图&nbsp;10</a>里的情况为例。</p>
<p>白噪声序列<span class="math inline">\(w_t\)</span>有<span class="math inline">\(\mu_{wt}=\operatorname{E}(w_t)=0\)</span>，进行平滑后有<span class="math inline">\(\mu_{vt}=\operatorname{E}(v_t)=\frac{1}{3}[\operatorname{E}(w_{t-1})+\operatorname{E}(w_t)+\operatorname{E}(w_{t-1})]=0\)</span>，平均函数不变。</p>
</section>
<section id="sec-randommean" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="sec-randommean"><span class="header-section-number">3.1.2</span> 带漂移项的随机游走的平均函数</h3>
<p>平均函数为一条直线，以<a href="#eq-rw" class="quarto-xref">式&nbsp;1</a>为例。</p>
<p>已知<span class="math inline">\(\operatorname{E}(w_t)=0\)</span>，<span class="math inline">\(\delta\)</span>为常数，有：</p>
<p><span class="math display">\[
\mu_{xt}=\operatorname{E}(x_t)=\delta t+\sum_{j=1}^{t}\operatorname{E}(w_j)=\delta t
\]</span></p>
<p>这是一条斜率为<span class="math inline">\(\delta\)</span>的直线，<a href="#fig-rw" class="quarto-xref">图&nbsp;12</a>中的虚线就是其平均函数。</p>
</section>
<section id="信号加噪声的平均函数" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="信号加噪声的平均函数"><span class="header-section-number">3.1.3</span> 信号加噪声的平均函数</h3>
<p>平均函数为余弦波，以<a href="#eq-cos" class="quarto-xref">式&nbsp;2</a>为例。</p>
<p><span class="math display">\[
\mu_{xt}=\operatorname{E}(x_t)=\operatorname{E}[2cos(2\pi\frac{t+15}{50})+w_t]=2cos(2\pi\frac{t+15}{50})+\operatorname{E}(w_t)=2cos(2\pi\frac{t+15}{50})
\]</span></p>
</section>
</section>
<section id="自协方差函数autocovariance-function" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="自协方差函数autocovariance-function"><span class="header-section-number">3.2</span> 自协方差函数(Autocovariance Function)</h2>
<p>对于任意<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>，<strong>自协方差函数</strong>被定义为二阶矩函数：</p>
<p><span id="eq-autof"><span class="math display">\[
\gamma_x(s,t)=\operatorname{cov}(x_s,x_t)=\operatorname{E}[(x_s-\mu_s)(x_t-\mu_t)]
\tag{4}\]</span></span></p>
<p>自协方差衡量在不同时间观察到的同一时间序列的两点间的<em>线性</em>依赖性。平滑的时间序列，即使<span class="math inline">\(t\)</span>和<span class="math inline">\(s\)</span>相隔很远，自协方差函数也会比较大；而波动大的时间序列，自协方差函数几乎为0。</p>
<p>从经典统计数据角度来看，如果<span class="math inline">\(\gamma_x(s,t)=0\)</span>，<span class="math inline">\(x_s\)</span>和<span class="math inline">\(x_t\)</span>非线性相关(可能有其他依赖结构)。但如果<span class="math inline">\(x_s\)</span>和<span class="math inline">\(x_t\)</span>是二元正态分布，<span class="math inline">\(\gamma_x(s,t)=0\)</span>说明相互独立。对于<span class="math inline">\(s=t\)</span>，自协方差就是方差，即：</p>
<p><span class="math display">\[
\gamma_x(t,t)=\operatorname{E}[(x_t-\mu_t)^2]=\operatorname{var}(x_t)
\]</span></p>
<section id="白噪声的自协方差" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="白噪声的自协方差"><span class="header-section-number">3.2.1</span> 白噪声的自协方差</h3>
<p>白噪声序列<span class="math inline">\(w_t\)</span>有<span class="math inline">\(\operatorname{E}(w_t)=0\)</span>，且</p>
<p><span class="math display">\[
\gamma_w(s,t)=\operatorname{cov}(w_s,w_t)=\begin{cases}
\sigma_w^2 &amp; s=t\\
0 &amp; s\neq t
\end{cases}
\]</span></p>
</section>
<section id="线性组合的协方差" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="线性组合的协方差"><span class="header-section-number">3.2.2</span> 线性组合的协方差</h3>
<p>我们经常要计算滤波序列之间的自协方差，可以用到下面的性质：</p>
<p>如果有随机变量</p>
<p><span class="math display">\[
U=\sum_{j=1}^ma_jX_j\ 和\ V=\sum_{k=1}^rb_kY_k
\]</span></p>
<p>分别是随机变量<span class="math inline">\(\{X_j\}\)</span>和<span class="math inline">\(\{Y_k\}\)</span>的线性组合，则它们的协方差为：</p>
<p><span class="math display">\[
\operatorname{cov}(U,V)=\sum_{j=1}^m\sum_{k=1}^ra_jb_k\operatorname{cov}(X_j,Y_k)
\]</span></p>
<p>且<span class="math inline">\(\operatorname{var}(U)=\operatorname{cov}(U,U)\)</span>。</p>
</section>
<section id="sec-movecov" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="sec-movecov"><span class="header-section-number">3.2.3</span> 移动平均值的自协方差</h3>
<p>以<a href="#sec-moveave" class="quarto-xref">小节&nbsp;2.2</a>中的例子为例。变换后的滤波序列有：</p>
<p><span class="math display">\[
\gamma_v(s,t)=\operatorname{cov}(v_s,v_t)=\operatorname{cov}\{\frac{1}{3}(w_{s-1}+w_s+w_{s+1}),\frac{1}{3}(w_{t-1}+w_t+w_{t+1})\}
\]</span></p>
<p>当<span class="math inline">\(s=t\)</span>时：</p>
<p><span class="math display">\[
\begin{aligned}
\gamma_v(t,t)&amp;=\frac{1}{9}\operatorname{cov}\{(w_{t-1}+w_t+w_{t+1}),(w_{t-1}+w_t+w_{t+1})\}\\
&amp;=\frac{1}{9}[\operatorname{cov}(w_{t-1},w_{t-1})+\operatorname{cov}(w_{t},w_{t})+\operatorname{cov}(w_{t+1},w_{t+1})]\\
&amp;=\frac{3}{9}\sigma_w^2
\end{aligned}
\]</span></p>
<p>当<span class="math inline">\(s=t+1\)</span>时：</p>
<p><span class="math display">\[
\begin{aligned}
\gamma_v(t+1,t)&amp;=\frac{1}{9}\operatorname{cov}\{(w_t+w_{t+1}+w_{t+2}),(w_{t-1}+w_t+w_{t+1})\}\\
&amp;=\frac{1}{9}[\operatorname{cov}(w_t,w_t)+\operatorname{cov}(w_{t+1},w_{t+1})+\operatorname{cov}(w_{t+2},w_{t-1})]\\
&amp;=\frac{1}{9}[\operatorname{cov}(w_t,w_t)+\operatorname{cov}(w_{t+1},w_{t+1})+0]\\
&amp;=\frac{2}{9}\sigma_w^2
\end{aligned}
\]</span></p>
<p>通过类似计算，我们得到<span class="math inline">\(\gamma_v(t-1,t)=\gamma_v(t+1,t)=\frac{2}{9}\sigma_w^2\)</span>，<span class="math inline">\(\gamma_v(t-2,t)=\gamma_v(t+2,t)=\frac{1}{9}\sigma_w^2\)</span>，当<span class="math inline">\(|t-s|&gt;2\)</span>时为0。即：</p>
<p><span class="math display">\[
\gamma_v(s,t)=\begin{cases}
\frac{3}{9}\sigma_w^2&amp;s=t\\
\frac{2}{9}\sigma_w^2&amp;|s-t|=1\\
\frac{1}{9}\sigma_w^2&amp;|s-t|=2\\
0&amp;|s-t|&gt;2
\end{cases}
\]</span></p>
<p>平滑后序列的协方差函数随两时间点间的间隔增加而减小，其协方差只取决于时间间隔或滞后，不取决于时间点在时间序列中的绝对位置。</p>
</section>
<section id="sec-randomcov" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="sec-randomcov"><span class="header-section-number">3.2.4</span> 随机游走的自协方差</h3>
<p>随机游走模型<span class="math inline">\(x_t=\sum_{j=1}^tw_j\)</span>，有</p>
<p><span class="math display">\[
\gamma_x(s,t)=\operatorname{cov}(x_s,x_t)=\operatorname{cov}(\sum_{j=1}^sw_j,\sum_{k=1}^tw_k)=\operatorname{min}\{s,t\}\sigma_w^2
\]</span></p>
<p>随机游走的自协方差函数取决于特定的时间值<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>，不取决于时间间隔或滞后。且<span class="math inline">\(\operatorname{var}(x_t)=\gamma_x(t,t)=t\sigma_w^2\)</span>。</p>
</section>
</section>
<section id="自相关函数autocorrelation-functionacf" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="自相关函数autocorrelation-functionacf"><span class="header-section-number">3.3</span> 自相关函数(Autocorrelation Function，ACF)</h2>
<p><span class="math display">\[
\rho(s,t)=\frac{\gamma(s,t)}{\sqrt{\gamma(s,s)\gamma(t,t)}}
\]</span></p>
<p>ACF用来衡量序列中不同时间点之间的依赖性，常用来检测周期性、趋势和模式。</p>
<section id="交叉协方差函数cross-covariance-function" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="交叉协方差函数cross-covariance-function"><span class="header-section-number">3.3.1</span> 交叉协方差函数(Cross-covariance Function)</h3>
<p><span class="math display">\[
\gamma_{xy}(s,t)=\operatorname{cov}(x_s,y_t)=\operatorname{E}[(x_s-\mu_{xs})(y_t-\mu_{yt})]
\]</span></p>
<p>交叉协方差函数用于衡量两个时间序列在不同滞后下的协方差。</p>
</section>
<section id="交叉相关函数cross-correlation-functionccf" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="交叉相关函数cross-correlation-functionccf"><span class="header-section-number">3.3.2</span> 交叉相关函数(cross-correlation function，CCF)</h3>
<p><span class="math display">\[
\rho_{xy}(s,t)=\frac{\gamma_{xy}(s,t)}{\sqrt{\gamma_x(s,s)\gamma_y(t,t)}}
\]</span></p>
<p>CCF用于衡量两个时间序列之间在不同滞后下的线性关系。它类似于自相关函数，但用于评估两个不同时间序列之间的相关性，而不仅仅是同一个序列的内部相关性。</p>
</section>
</section>
</section>
<section id="平稳时间序列stationary-time-series" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 平稳时间序列(Stationary Time Series)</h1>
<section id="严格平稳strictly-stationary" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="严格平稳strictly-stationary"><span class="header-section-number">4.1</span> 严格平稳(Strictly Stationary)</h2>
<p>如果时间序列每个值的集合<span class="math inline">\(\{x_{t_1},\ x_{t_2},\ \cdots,\ x_{t_k}\}\)</span>的概率等于时间移动后值的集合<span class="math inline">\(\{x_{t_1+h},\ x_{t_2+h},\ \cdots,\ x_{t_k+h}\}\)</span>的概率，即</p>
<p><span id="eq-stationary"><span class="math display">\[
\Pr\{x_{t_1}\le c_1,\cdots,x_{t_k}\le c_k\}=\Pr\{x_{t_1+h}\le c_1,\cdots,x_{t_k+h}\le c_k\}
\tag{5}\]</span></span></p>
<p>其中所有<span class="math inline">\(k=1,\ 2,\ \cdots\)</span>，所有时间点<span class="math inline">\(t_1,\ t_2,\ \cdots,\ t_k\)</span>，所有数值<span class="math inline">\(c_1,\ c_2,\ \cdots,\ c_k\)</span>和所有时间移动<span class="math inline">\(h=0,\ \pm1,\ \pm2,\ \cdots\)</span>。</p>
<p>当<span class="math inline">\(k=1\)</span>时，<a href="#eq-stationary" class="quarto-xref">式&nbsp;5</a>变为对任意<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span></p>
<p><span id="eq-stationaryk1"><span class="math display">\[
\Pr\{x_s\le c\}=\Pr\{x_t\le c\}
\tag{6}\]</span></span></p>
<p>可见严格平稳的时间序列对于所有<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>，<span class="math inline">\(\mu_s=\mu_t\)</span>，因此<span class="math inline">\(\mu_t\)</span>必定为常数。</p>
<p>当<span class="math inline">\(k=2\)</span>时，<a href="#eq-stationary" class="quarto-xref">式&nbsp;5</a>又变为对任意<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>以及位移<span class="math inline">\(h\)</span></p>
<p><span id="eq-stationaryk2"><span class="math display">\[
\Pr\{x_s\le c_1,x_t\le c_2\}=\Pr\{x_{s+h}\le c_1,x_{t+h}\le c_2\}
\tag{7}\]</span></span></p>
<p>根据<a href="#eq-stationaryk1" class="quarto-xref">式&nbsp;6</a>和<a href="#eq-stationaryk2" class="quarto-xref">式&nbsp;7</a>可推知，对任意<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>以及位移<span class="math inline">\(h\)</span></p>
<p><span class="math display">\[
\gamma(s,t)=\gamma(s+h,t+h)
\]</span></p>
<p>严格平稳的时间序列自协方差函数取决于<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>之间的时间差异，而不是具体时间点。</p>
</section>
<section id="弱平稳weakly-stationary" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="弱平稳weakly-stationary"><span class="header-section-number">4.2</span> 弱平稳(Weakly Stationary)</h2>
<p>弱平稳时间序列<span class="math inline">\(x_t\)</span>是一个方差有限的随机过程，满足以下条件：</p>
<ol type="1">
<li><p><a href="#eq-meanf" class="quarto-xref">式&nbsp;3</a>中定义的均值函数<span class="math inline">\(\mu_t\)</span>是常数，不依赖于时间<span class="math inline">\(t\)</span>；</p></li>
<li><p><a href="#eq-autof" class="quarto-xref">式&nbsp;4</a>中定义的自协方差函数<span class="math inline">\(\gamma(s,t)\)</span>仅取决于<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>的差值<span class="math inline">\(|s-t|\)</span>而不是具体的<span class="math inline">\(s\)</span>或者<span class="math inline">\(t\)</span>的取值。</p></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>条件1和2可推导出方差恒定，同时方差恒定和自协方差函数仅取决于时差可以推导出均值恒定，但均值恒定和方差恒定不能推导出自协方差函数仅取决于时差。</p>
<p>严格平稳要求序列的所有阶矩(如均值、方差、偏度、峰度等)都不随时间变化(如抛硬币，理想情况下随时随刻抛正反面分布情况不变)，弱平稳的要求则宽松一些，只要求前两阶矩(均值、方差)恒定。</p>
<p>阶矩用来衡量数据的分布情况。</p>
<p>一阶矩<span class="math inline">\(\operatorname{E}[X]\)</span>衡量均值(<span class="math inline">\(\mu\)</span>)；二阶矩<span class="math inline">\(\operatorname{E}[(X-\mu)^2]\)</span>衡量方差(<span class="math inline">\(\sigma^2\)</span>)；三阶矩<span class="math inline">\(\operatorname{E}[(X-\mu)^3]\)</span>衡量偏度(<span class="math inline">\(\gamma_1\)</span>)；四阶矩<span class="math inline">\(\operatorname{E}[(X-\mu)^4]\)</span>衡量峰度(<span class="math inline">\(\gamma_2\)</span>)；五阶矩表达式为<span class="math inline">\(\operatorname{E}[(X-\mu)^5]\)</span>，衡量更高的维度。</p>
</div>
</div>
<p>我们很难从单个数据集中评估出严格平稳，更多的是使用弱平稳。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注释
</div>
</div>
<div class="callout-body-container callout-body">
<p>为了方便，之后使用<strong>平稳</strong>表示弱平稳，<strong>严平稳</strong>表示严格平稳。</p>
</div>
</div>
<p>方差有限的严平稳也是弱平稳。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注释
</div>
</div>
<div class="callout-body-container callout-body">
<p>平稳时间序列的均值<span class="math inline">\(\operatorname{E}(x_t)=\mu_t\)</span>与时间<span class="math inline">\(t\)</span>无关，方便起见用<span class="math inline">\(\mu\)</span>表示<span class="math inline">\(\mu_t\)</span>。</p>
<p>平稳时间序列<span class="math inline">\(x_t\)</span>的自协方差函数<span class="math inline">\(\gamma(s,t)\)</span>仅取决于时差<span class="math inline">\(|s-t|\)</span>，令<span class="math inline">\(s=t+h\)</span>，<span class="math inline">\(h\)</span>表示时移或滞后，则</p>
<p><span class="math display">\[
\gamma(t+h,t)=\operatorname{cov}(x_{t+h},x_t)=\operatorname{cov}(x_h,x_0)=\gamma(h,0)
\]</span></p>
<p>方便起见简写为<span class="math inline">\(\gamma(h)\)</span>。</p>
</div>
</div>
<p>平稳时间序列的自协方差函数为：</p>
<p><span class="math display">\[
\gamma(h)=\operatorname{cov}(x_{t+h},x_t)=\operatorname{E}[(x_{t+h}-\mu)(x_t-\mu)]
\]</span></p>
<p>平稳时间序列的自相关函数(ACF)为：</p>
<p><span id="eq-weaklyacf"><span class="math display">\[
\rho(h)=\frac{\gamma(t+h,t)}{\sqrt{\gamma(t+h,t+h)\gamma(t,t)}}=\frac{\gamma(h)}{\gamma(0)}
\tag{8}\]</span></span></p>
<section id="白噪声的平稳性" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="白噪声的平稳性"><span class="header-section-number">4.2.1</span> 白噪声的平稳性</h3>
<p><a href="#sec-whitenoise" class="quarto-xref">小节&nbsp;2.1</a>和<a href="#sec-autoregressions" class="quarto-xref">小节&nbsp;2.3</a>所展示的白噪声序列均值为<span class="math inline">\(\mu_{wt}=0\)</span>，自协方差函数为：</p>
<p><span class="math display">\[
\gamma_w(h)=\operatorname{cov}(w_{t+h},w_t)=\begin{cases}
\sigma_w^2&amp;h=0\\
0&amp;h\neq0\\
\end{cases}
\]</span></p>
<p>白噪声为弱平稳时间序列，如果白噪声符合正态分布或高斯分布，则还是严格平稳的。因此自相关函数为<span class="math inline">\(\rho_w(0)=1\)</span>，且当<span class="math inline">\(h\neq0\)</span>时，<span class="math inline">\(\rho(h)=0\)</span>。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>书中似乎错误引用<a href="#eq-stationary" class="quarto-xref">式&nbsp;5</a>，应该是根据<a href="#eq-weaklyacf" class="quarto-xref">式&nbsp;8</a>计算，自相关函数为： <span class="math display">\[
\rho_w(h)=\begin{cases}
\frac{\gamma_w(0)}{\gamma_w(0)}=\frac{\sigma_w^2}{\sigma_w^2}=1&amp;h=0\\
\frac{\gamma_w(h)}{\gamma_w(0)}=\frac{0}{\sigma_w^2}=0&amp;h\neq0
\end{cases}
\]</span></p>
</div>
</div>
</section>
<section id="移动平均序列的平稳性" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="移动平均序列的平稳性"><span class="header-section-number">4.2.2</span> 移动平均序列的平稳性</h3>
<p><a href="#sec-moveave" class="quarto-xref">小节&nbsp;2.2</a>中的三点移动平均过程是平稳的。根据<a href="#sec-movemean" class="quarto-xref">小节&nbsp;3.1.1</a>和<a href="#sec-movecov" class="quarto-xref">小节&nbsp;3.2.3</a>中的内容可知其均值为<span class="math inline">\(\mu_{vt}=0\)</span>，自协方差函数为：</p>
<p><span class="math display">\[
\gamma_v(h)=\begin{cases}
\frac{3}{9}\sigma_w^2&amp;h=0\\
\frac{2}{9}\sigma_w^2&amp;h\pm1\\
\frac{3}{9}\sigma_w^2&amp;h\pm2\\
\frac{3}{9}\sigma_w^2&amp;|h|&gt;2\\
\end{cases}
\]</span></p>
<p>与时间<span class="math inline">\(t\)</span>无关。自相关函数为：</p>
<p><span class="math display">\[
\rho_v(h)=\begin{cases}
1&amp;h=0\\
\frac{2}{3}&amp;h\pm1\\
\frac{1}{3}&amp;h\pm2\\
0&amp;|h|&gt;2\\
\end{cases}
\]</span></p>
<p>其关于滞后值0对称。</p>
</section>
<section id="随机游走是非平稳的" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="随机游走是非平稳的"><span class="header-section-number">4.2.3</span> 随机游走是非平稳的</h3>
<p>由<a href="#sec-randommean" class="quarto-xref">小节&nbsp;3.1.2</a>和<a href="#sec-randomcov" class="quarto-xref">小节&nbsp;3.2.4</a>可知，随机游走的平均函数为<span class="math inline">\(\mu_{xt}=\delta t\)</span>，自协方差函数为<span class="math inline">\(\gamma_x(s,t)=\operatorname{min}\{s,t\}\sigma_w^2\)</span>，都和时间有关，故随机游走不是平稳的。</p>
</section>
<section id="趋势平稳性trend-stationarity" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="趋势平稳性trend-stationarity"><span class="header-section-number">4.2.4</span> 趋势平稳性(Trend Stationarity)</h3>
<p>趋势平稳性指模型围绕线性趋势的平稳行为，即均值函数不独立于时间，但自协方差函数独立于时间。</p>
<p>如<span class="math inline">\(x_t=\alpha+\beta t+y_t\)</span>，其中<span class="math inline">\(y_t\)</span>是平稳的，则均值函数为<span class="math inline">\(\mu_{x,t}=\operatorname{E}(x_t)=\alpha+\beta t+\mu_y\)</span>，不独立于时间；自协方差函数为<span class="math inline">\(\gamma_x(h)=\operatorname{cov}(x_{t+h},x_t)=\operatorname{E}[(x_{t+h}-\mu_{x,t+h})(x_t-\mu_{x,t})]=\operatorname{E}[(y_{t+h}-\mu_y)(y_t-\mu_y)]=\gamma_y(h)\)</span>，独立于时间。</p>
<p>例子如<a href="#fig-chicken" class="quarto-xref">图&nbsp;14</a>所示。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-chicken" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-chicken-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-chicken-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-chicken-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;14: 鸡肉价格
</figcaption>
</figure>
</div>
</div>
</div>
<p>这种数据有以下几个特殊属性：</p>
<ol type="1">
<li><span class="math inline">\(\gamma(h)\)</span>非负；</li>
<li><span class="math inline">\(\gamma(0)=\operatorname{E}[(x_t-\mu)^2]\)</span>；</li>
<li>自协方差函数关于原点对称，<span class="math inline">\(\gamma(h)=\gamma(-h)\)</span>。</li>
</ol>
</section>
</section>
<section id="联合平稳jointly-stationary" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="联合平稳jointly-stationary"><span class="header-section-number">4.3</span> 联合平稳(Jointly Stationary)</h2>
<p>两个时间序列<span class="math inline">\(x_t\)</span>和<span class="math inline">\(y_t\)</span>均是平稳的，且它们的交叉协方差函数为：</p>
<p><span class="math display">\[
\gamma_{xy}(h)=\operatorname{cov}(x_{t+h},y_t)=\operatorname{E}[(x_{t+h}-\mu_x)(y_t-\mu_y)]
\]</span></p>
<p>我们称<span class="math inline">\(x_t\)</span>和<span class="math inline">\(y_t\)</span>是联合平稳的，且交叉协方差函数仅和滞后值<span class="math inline">\(h\)</span>有关。</p>
<section id="交叉相关函数cross-correlation-functionccf-1" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="交叉相关函数cross-correlation-functionccf-1"><span class="header-section-number">4.3.1</span> 交叉相关函数(Cross-Correlation Function，CCF)</h3>
<p>联合平稳时间序列<span class="math inline">\(x_t\)</span>和<span class="math inline">\(y_t\)</span>的交叉相关函数为：</p>
<p><span id="eq-ccf"><span class="math display">\[
\rho_{xy}(h)=\frac{\gamma_{xy}(h)}{\sqrt{\gamma_x(0)\gamma_y(0)}}
\tag{9}\]</span></span></p>
<p>其交叉相关函数通常关于0不对称，即<span class="math inline">\(\rho_{xy}(h)\neq \rho_{xy}(-h)\)</span>，即<span class="math inline">\(\operatorname{cov}(x_2,y_1)\)</span>和<span class="math inline">\(\operatorname{cov}(x_1,y_2)\)</span>不必相同。</p>
<p>但<span class="math inline">\(\rho_{xy}(h)=\rho_{yx}(-h)\)</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>这里给出推导过程。</p>
<p><span class="math inline">\(\rho_{xy}(h)\neq \rho_{xy}(-h)\)</span>是因为：</p>
<p><span class="math display">\[
\rho_{xy}(h)=\frac{\gamma_{xy}(h)}{\sqrt{\gamma_x(0)\gamma_y(0)}}
\]</span></p>
<p>和</p>
<p><span class="math display">\[
\rho_{xy}(-h)=\frac{\gamma_{xy}(-h)}{\sqrt{\gamma_x(0)\gamma_y(0)}}
\]</span></p>
<p>中，<span class="math inline">\(\gamma_{xy}(h)\neq \gamma_{xy}(-h)\)</span>，即：</p>
<p><span class="math display">\[
\operatorname{cov}(x_{t+h},y_t)\neq\operatorname{cov}(x_t,y_{t+h})
\]</span></p>
<p><span class="math inline">\(\rho_{xy}(h)=\rho_{yx}(-h)\)</span>是因为：</p>
<p><span class="math display">\[
\rho_{yx}(-h)=\frac{\gamma_{yx}(-h)}{\sqrt{\gamma_y(0)\gamma_x(0)}}
\]</span></p>
<p>根据协方差的性质：</p>
<p><span class="math display">\[
\operatorname{cov}(x_t,y_{t+h})=\operatorname{E}[(x_t-\mu_x)(y_{t+h}-\mu_y)]=\operatorname{E}[(y_{t+h}-\mu_y)(x_t-\mu_x)]=\operatorname{cov}(y_{t+h},x_t)
\]</span></p>
<p>即：</p>
<p><span class="math display">\[
\operatorname{cov}(A,B)=\operatorname{cov}(B,A)
\]</span></p>
<p>可得：</p>
<p><span class="math display">\[
\gamma_{yx}(-h)=\operatorname{cov}(y_{t-h},x_t)=\operatorname{cov}(x_t,y_{t-h})=\gamma_{xy}(h)
\]</span></p>
</div>
</div>
</section>
<section id="联合平稳性joint-stationarity" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="联合平稳性joint-stationarity"><span class="header-section-number">4.3.2</span> 联合平稳性(Joint Stationarity)</h3>
<p>两个序列<span class="math inline">\(x_t\)</span>和<span class="math inline">\(y_t\)</span>，分别是白噪声过程两个连续值的和与差，即<span class="math inline">\(x_t=w_t+w_{t-1}\)</span>和<span class="math inline">\(y_t=w_t-w_{t-1}\)</span>，其中<span class="math inline">\(w_t\)</span>是均值为0，方差为<span class="math inline">\(\sigma_w^2\)</span>的独立随机变量。易证<span class="math inline">\(\gamma_x(0)=\gamma_y(0)=2\sigma_w^2\)</span>，以及<span class="math inline">\(\gamma_x(1)=\gamma_y(-1)=\sigma_w^2\)</span>、<span class="math inline">\(\gamma_y(1)=\gamma_x(-1)=-\sigma_w^2\)</span>。</p>
<p>同时有：</p>
<p><span id="eq-jointcov"><span class="math display">\[
\gamma_{xy}(1)=\operatorname{cov}(x_{t+1},y_t)=\operatorname{cov}(w_{t+1}+w_t,w_t-w_{t-1})=\sigma_w^2
\tag{10}\]</span></span></p>
<p>类似的：<span class="math inline">\(\gamma_{xy}(0)=0\)</span>、<span class="math inline">\(\gamma_{xy}(-1)=-\sigma_w^2\)</span>。根据<a href="#eq-ccf" class="quarto-xref">式&nbsp;9</a>，可得：</p>
<p><span class="math display">\[
\rho_{xy}(h)=\begin{cases}
0&amp;h=0\\
1/2&amp;h=1\\
-1/2&amp;h=-1\\
0&amp;|h|\ge2
\end{cases}
\]</span></p>
<p>自协方差和交叉协方差函数仅取决于滞后值<span class="math inline">\(h\)</span>，因此序列是联合平稳的。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>给出补充的推导过程帮助记忆和理解。</p>
<p><strong>注意</strong>：<span class="math inline">\(\gamma_{xy}(h)\)</span>等于<span class="math inline">\(\operatorname{cov}(x_{t+h},y_t)\)</span>，而不是等于<span class="math inline">\(\operatorname{cov}(x_t,y_{t+h})\)</span>，在自协方差里面混淆了不影响结果，但在交叉协方差里面是有影响的。</p>
<ol type="1">
<li><strong>方差</strong></li>
</ol>
<p>因为是独立随机变量，所以<span class="math inline">\(\operatorname{cov}(w_t,w_{t-1})=0\)</span>，所以：</p>
<p><span class="math display">\[
\gamma_x(0)=\operatorname{var}(x_t)=\operatorname{var}(w_t+w_{t-1})=\operatorname{var}(w_t)+\operatorname{var}(w_{t-1})+2\operatorname{cov}(w_t,w_{t-1})=2\sigma_w^2
\]</span></p>
<p>同理：</p>
<p><span class="math display">\[
\gamma_y(0)=\operatorname{var}(y_t)=\operatorname{var}(w_t-w_{t-1})=\operatorname{var}(w_t)+\operatorname{var}(w_{t-1})-2\operatorname{cov}(w_t,w_{t-1})=2\sigma_w^2
\]</span></p>
<ol start="2" type="1">
<li><strong>滞后自协方差</strong></li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\gamma_x(1)=\operatorname{cov}(x_{t+1},x_t)
&amp;=\operatorname{cov}(w_{t+1}+w_t,w_t+w_{t-1})\\
&amp;=\operatorname{cov}(w_{t+1},w_t)+\operatorname{cov}(w_{t+1},w_{t-1})+\operatorname{cov}(w_t,w_t)+\operatorname{cov}(w_t,w_{t-1})\\
&amp;=0+0+\sigma_w^2+0\\
&amp;=\sigma_w^2
\end{aligned}
\]</span></p>
<p>类似的：</p>
<p><span class="math display">\[
\begin{aligned}
\gamma_y(1)=\operatorname{cov}(y_{t+1},y_t)
&amp;=\operatorname{cov}(w_{t+1}-w_t,w_t-w_{t-1})\\
&amp;=\operatorname{cov}(w_{t+1},w_t)-\operatorname{cov}(w_{t+1},w_{t-1})-\operatorname{cov}(w_t,w_t)+\operatorname{cov}(w_t,w_{t-1})\\
&amp;=0-0-\sigma_w^2+0\\
&amp;=-\sigma_w^2
\end{aligned}
\]</span></p>
<ol start="3" type="1">
<li><strong>自协方差</strong></li>
</ol>
<p><span class="math display">\[
\gamma_x(h)=\begin{cases}
2\sigma_w^2&amp;h=0\\
\sigma_w^2&amp;|h|=1\\
0&amp;|h|\ge2\\
\end{cases}
\]</span></p>
<p><span class="math display">\[
\gamma_y(h)=\begin{cases}
2\sigma_w^2&amp;h=0\\
-\sigma_w^2&amp;|h|=1\\
0&amp;|h|\ge2\\
\end{cases}
\]</span></p>
<p>交叉相关函数是在<a href="#eq-jointcov" class="quarto-xref">式&nbsp;10</a>的基础上，简单的公式代入，不做补充推导。</p>
</div>
</div>
</section>
<section id="使用交叉相关进行预测" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="使用交叉相关进行预测"><span class="header-section-number">4.3.3</span> 使用交叉相关进行预测</h3>
<p>有模型：</p>
<p><span class="math display">\[
y_t=Ax_{t-\ell}+w_t
\]</span></p>
<p><strong>前导</strong>(lead)：当<span class="math inline">\(\ell&gt;0\)</span>时，序列<span class="math inline">\(x_t\)</span>是序列<span class="math inline">\(y_t\)</span>的前导；</p>
<p><strong>滞后</strong>(lag)：当<span class="math inline">\(\ell&lt;0\)</span>时，序列<span class="math inline">\(x_t\)</span>是序列<span class="math inline">\(y_t\)</span>的滞后。</p>
<p>在用<span class="math inline">\(x_t\)</span>预测<span class="math inline">\(y_t\)</span>时，判断清楚前导和滞后关系很重要。</p>
<p>假设噪声<span class="math inline">\(w_t\)</span>和<span class="math inline">\(x_t\)</span>不相关，则交叉协方差函数如下：</p>
<p><span class="math display">\[
\begin{aligned}
\gamma_{yx}(h)
&amp;=\operatorname{cov}(y_{t+h},x_t)=\operatorname{cov}(Ax_{t+h-\ell}+w_{t+h},x_t)\\
&amp;=\operatorname{cov}(Ax_{t+h-\ell},x_t)=A\gamma_x(h-\ell)
\end{aligned}
\]</span></p>
<p>根据柯西不等式(Cauchy-Schwarz)，当<span class="math inline">\(h=\ell\)</span>时，即<span class="math inline">\(\gamma_x(0)\)</span>时，<span class="math inline">\(\gamma_{yx}(h)\)</span>取最大绝对值。如果<span class="math inline">\(h&gt;0\)</span>时取最大绝对值，说明<span class="math inline">\(x_t\)</span>是<span class="math inline">\(y_t\)</span>的先导；如果<span class="math inline">\(h&lt;0\)</span>时取最大绝对值，说明<span class="math inline">\(x_t\)</span>滞后于<span class="math inline">\(y_t\)</span>。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>因为是相关，不涉及因果，所以先导和滞后都是相对的。</p>
<p>考虑到标准差一般为固定值，协方差最大的时候，就是<span class="math inline">\(x_t\)</span>和<span class="math inline">\(y_t\)</span>相关性最强的时候。</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> stats<span class="sc">::</span><span class="fu">lag</span>(x, <span class="sc">-</span><span class="dv">5</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>) <span class="co"># h = 5</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>astsa<span class="sc">::</span><span class="fu">ccf2</span>(y, x, <span class="at">ylab =</span> <span class="st">'CCovF'</span>, <span class="at">type =</span> <span class="st">'covariance'</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( <span class="dv">9</span>, <span class="fl">1.1</span>, <span class="st">'x leads'</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="fl">1.1</span>, <span class="st">'y leads'</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CCovF" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-CCovF-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-CCovF-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-CCovF-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;15: 交叉协方差函数
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="线性随机过程linear-process" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="线性随机过程linear-process"><span class="header-section-number">4.4</span> 线性(随机)过程(Linear Process)</h2>
<p><span class="math inline">\(x_t\)</span>是白噪声<span class="math inline">\(w_t\)</span>的线性组合，具体如下：</p>
<p><span id="eq-linerprocess"><span class="math display">\[
x_t=\mu+\sum_{j=-\infty}^{\infty}\psi_jw_{t-j},\ \sum_{j=-\infty}^{\infty}|\psi_j|&lt;\infty
\tag{11}\]</span></span></p>
<p>当<span class="math inline">\(h\ge0\)</span>时，其自协方差函数为：</p>
<p><span id="eq-linerprocesscov"><span class="math display">\[
\gamma_x(h)=\sigma_w^2\sum_{j=-\infty}^{\infty}\psi_{j+h}\psi_j
\tag{12}\]</span></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>模型解释</strong></li>
</ol>
<p><a href="#eq-linerprocess" class="quarto-xref">式&nbsp;11</a>表示一种广义的线性随机过程。</p>
<p><span class="math display">\[
x_t=\mu+\sum_{j=-\infty}^{\infty}\psi_jw_{t-j},\ \sum_{j=-\infty}^{\infty}|\psi_j|&lt;\infty
\]</span></p>
<p>其中：</p>
<ul>
<li><p><span class="math inline">\(x_t\)</span>：当前时间点<span class="math inline">\(t\)</span>的观测值；</p></li>
<li><p><span class="math inline">\(\mu\)</span>：序列的均值；</p></li>
<li><p><span class="math inline">\(\psi_j\)</span>：权重系数，描述了过去(<span class="math inline">\(j&gt;0\)</span>)、现在(<span class="math inline">\(j=0\)</span>)和未来(<span class="math inline">\(j &lt; 0\)</span>)的随机扰动对当前观测值的影响；</p></li>
<li><p><span class="math inline">\(w_t\)</span>：随机扰动项。</p></li>
</ul>
<ol start="2" type="1">
<li><strong>自协方差函数推导</strong></li>
</ol>
<p><span class="math display">\[
\gamma_x(h)=\operatorname{cov}(x_{t+h},x_t)
\]</span></p>
<p>将给定的<span class="math inline">\(x_t\)</span>代入：</p>
<p><span class="math display">\[
\begin{aligned}
\gamma_x(h)
&amp;=\operatorname{cov}(\mu+\sum_{j=-\infty}^{\infty}\psi_jw_{t+h-j},\mu+\sum_{k=-\infty}^{\infty}\psi_kw_{t-k})\\
&amp;=\operatorname{cov}(\sum_{j=-\infty}^{\infty}\psi_jw_{t+h-j},\sum_{k=-\infty}^{\infty}\psi_kw_{t-k})\\
&amp;=\sum_{j=-\infty}^{\infty}\sum_{k=-\infty}^{\infty}\psi_j\psi_k\operatorname{cov}(w_{t+h-j},w_{t-k})
\end{aligned}
\]</span></p>
<p>当<span class="math inline">\(k=j-h\)</span>时，<span class="math inline">\(\operatorname{cov}(w_{t+h-j},w_{t-k})=\sigma_w^2\)</span>；</p>
<p>当<span class="math inline">\(k\neq j-h\)</span>时，<span class="math inline">\(\operatorname{cov}(w_{t+h-j},w_{t-k})=0\)</span>。</p>
<p>因此，非零项只发生在<span class="math inline">\(k=j-h\)</span>处，表达式可简化为：</p>
<p><span class="math display">\[
\gamma_x(h)=\sigma_w^2\sum_{j=-\infty}^{\infty}\psi_j\psi_{j-h}
\]</span></p>
<p>这和<a href="#eq-linerprocesscov" class="quarto-xref">式&nbsp;12</a>是一致的。</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>正态时间序列(高斯时间序列)之后也会涉及，目前来看在理解上没那么重要，如有需求会在后续补上。</p>
</div>
</div>
</section>
</section>
<section id="相关系数的估计" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 相关系数的估计</h1>
<p>上面论述的内容只适用于假设的模型，但大部分研究都是通过样本数据来分析整体的，因此我们要在平稳性假设的基础上进行分析。</p>
<p>如果时间序列是平稳的，均值函数是一个常数，可以用样本均值来估计：</p>
<p><span class="math display">\[
\bar x=\frac{1}{n}\sum_{t=1}^nx_t
\]</span></p>
<p>方差为：</p>
<p><span id="eq-estvar"><span class="math display">\[
\begin{aligned}
\operatorname{var}(\bar{x})
&amp;=\operatorname{var}(\frac{1}{n}\sum_{t=1}^nx_t)=\frac{1}{n^2}\operatorname{cov}(\sum_{t=1}^{n}x_t,\sum_{s=1}^{n}x_s)\\
&amp;\begin{aligned}=
&amp;\frac{1}{n^2}(n\gamma_x(0)+(n-1)\gamma_x(1)+(n-2)\gamma_x(2)+\cdots+\gamma_x(n-1)\\
&amp;+(n-1)\gamma_x(-1)+(n-2)\gamma_x(-2)+\cdots+\gamma_x(1-n))
\end{aligned}\\
&amp;=\frac{1}{n}\sum_{h=-n}^{n}(1-\frac{|h|}{n})\gamma_x(h)
\end{aligned}
\tag{13}\]</span></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
提示
</div>
</div>
<div class="callout-body-container callout-body">
<p>对<a href="#eq-estvar" class="quarto-xref">式&nbsp;13</a>补充部分推导过程。</p>
<p><span class="math display">\[
\frac{1}{n^2}\operatorname{cov}(\sum_{t=1}^{n}x_t,\sum_{s=1}^{n}x_s)=\frac{1}{n^2}\sum_{t=1}^{n}\sum_{s=1}^{n}\operatorname{cov}(x_t,x_s)=\frac{1}{n^2}\sum_{t=1}^{n}\sum_{s=1}^{n}\gamma_x(t-s)
\]</span></p>
<p>有<span class="math inline">\(n\)</span>对<span class="math inline">\(t-s=0\)</span>；<span class="math inline">\(n-1\)</span>对<span class="math inline">\(t-s=1\)</span>和<span class="math inline">\(t-s=-1\)</span>；<span class="math inline">\(n-2\)</span>对<span class="math inline">\(t-s=2\)</span>和<span class="math inline">\(t-s=-2\)</span>；……</p>
<p>展开后，因为<span class="math inline">\(\gamma_x(n)=\gamma_x(-n)\)</span>，令<span class="math inline">\(h=t-s\)</span>，合并得到：</p>
<p><span class="math display">\[
\frac{1}{n}\sum_{h=-n}^{n}(1-\frac{|h|}{n})\gamma_x(h)
\]</span></p>
</div>
</div>
<section id="样本自协方差函数sample-autocovariance-function" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="样本自协方差函数sample-autocovariance-function"><span class="header-section-number">5.1</span> 样本自协方差函数(Sample Autocovariance Function)</h2>
<p><span class="math display">\[
\hat\gamma(h)=n^{-1}\sum_{t=1}^{n-h}(x_{t+h}-\bar x)(x_t-\bar x)
\]</span></p>
<p>其中<span class="math inline">\(h=0,1,\cdots,n-1\)</span>，且<span class="math inline">\(\hat\gamma(-h)=\hat\gamma(h)\)</span></p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">参考文献</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-Shumway_2017" class="csl-entry" role="listitem">
Shumway, R. H., &amp; Stoffer, D. S. (2017). <em>Time series analysis and its applications: With r examples</em> (4th ed.). Springer Cham. <a href="https://doi.org/10.1007/978-3-319-52452-8">https://doi.org/10.1007/978-3-319-52452-8</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>